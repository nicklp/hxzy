<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace 这个xml的里面所有的操作，都是要对这个 Mapper 接口进行定义 -->
<mapper namespace="com.wisezone.mapper.CVInfoMapper">
	 <insert id="insert" parameterType="com.wisezone.entity.CVInfo" useGeneratedKeys="true" keyProperty="tId">
		insert into cv_info(
			stu_name,phone,sex,school,education,major,job,msg_from,td_type,intention,cv_details,create_date
		) 
		values(
			#{stuName},
			#{phone},
			#{sex},
			#{school},
			#{education},
			#{major},
			#{job},
			#{msgFrom},
			#{tdType},
			#{intention},
			#{details},
			#{createDate}
		)
	</insert> 
	
	<resultMap type="com.wisezone.entity.CVInfo" id="cvInfo">
		<result column="stu_name" jdbcType="VARCHAR" property="stuName"/>
		<result column="phone" jdbcType="VARCHAR" property="phone"/>
		<result column="sex" jdbcType="VARCHAR" property="sex"/>
		<result column="school" jdbcType="VARCHAR" property="school"/>
		<result column="education" jdbcType="VARCHAR" property="education"/>
		<result column="major" jdbcType="VARCHAR" property="major"/>
		<result column="job" jdbcType="VARCHAR" property="job"/>
		<result column="msg_from" jdbcType="VARCHAR" property="msgFrom"/>
		<result column="td_type" jdbcType="VARCHAR" property="tdType"/>
		<result column="intention" jdbcType="VARCHAR" property="intention"/>
		<result column="cv_details" jdbcType="VARCHAR" property="details"/>
		<result column="create_date" jdbcType="DATE" property="createDate"/>
	</resultMap>
	
	<select id="queryNameAndPhone" parameterType="map" resultMap="cvInfo">
			select stu_name, phone,school,major,msg_from,create_date from cv_info 
			<where>
			    <if test="stuName!=null and stuName!=''">
			      stu_name = #{stuName}
			    </if>
			    <if test="phone!=null and phone!=''">
			      AND phone = #{phone}
			    </if>
		   </where>
	</select>
	
	<!--分页查询-->
	<!-- 根据面试者姓名或者电话，录入日期查询的分页 -->
	<sql id="_searchPaging">
		<where>
		 	<if test="param != null">
		  		<if test="searchText != null and searchText != ''">
		  			<if test="s_text == 1">
			  			and t.stu_name = #{searchText}
		  			</if>
		  			<if test="s_text == 2">
			  			and t.phone = #{searchText}
		  			</if>
		  		</if>
		  		<if test="s_date == 1">
		  			<if test="from_date != null and from_date != ''">
		  				<![CDATA[ and t.create_date >= #{from_date}]]>
		  			</if>
		  			<if test="to_date != null and to_date != ''">
		  				<![CDATA[ and t.create_date <= #{to_date}]]>
		  			</if>
		  		</if>
			</if>
		</where>
	 </sql>
   <select id="searchPaging"  resultType="map" parameterType="map">
      select 
		t.t_id tId,	
		t.stu_name stuName,
		(select t1.login_name from user_info t1 inner join user_cv_rel t2 on t1.t_id = t2.user_id where t2.stu_id = t.t_id) userName,
	  	t.create_date createDate,
		(select t1.visit_date from user_cv_rel t1 where t1.stu_id = t.t_id) visitDate,
		(select t1.pre_pay_date from user_cv_rel t1 where t1.stu_id = t.t_id) prePayDate,
		(select t1.pay_date from user_cv_rel t1 where t1.stu_id = t.t_id) payDate,
		(select t1.pay_type from user_cv_rel t1 where t1.stu_id = t.t_id) payType,
		(select t1.pay from user_cv_rel t1 where t1.stu_id = t.t_id) pay,
		t.major,
		t.phone,
		t.education,
		t.job,
		t.msg_from msgFrom,
		t.school,
		t.intention
	  from cv_info t
	  <include refid="_searchPaging"></include>
	  order by t.create_date desc
      <!-- 分页 -->
      limit #{offset}, #{limit}
 </select>
      
 <!-- 分页查询 -->
 <!-- 根据面试者姓名或者电话，录入日期查询的分页 -->
 <select id="searchPagingCount"  resultType="int">
      select count(*) from cv_info t
	  <include refid="_searchPaging"></include>
	  order by t.create_date desc
 </select>
</mapper>